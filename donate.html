<!DOCTYPE html>
<html lang="en">

<head>
    <title>DRRP Donate</title>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <style>
        body {
            color: white;
            font-weight: bold;
        }

        .background {
            background: black;
            background-image: url(img/screenshots/fullsize/reactor.jpg);
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-position: center;
            z-index: -1;
            filter: blur(5px) brightness(0.5);
        }

        .page {
            width: 75vw;
            margin: 10px auto;
        }

        main {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        h1, h2 {
            text-align: center;
            width: 100%;
        }

        article {
            border: 1px solid gray;
            border-radius: 15px;
            margin: 5px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 400px;
            background: rgba(0, 0, 0, 0.6);
        }

        article header {
            font-size: 125%;
            font-weight: bold;
        }

        article img {
            width: 256px;
            height: 256px;
            background: white;
            margin: 6px;
        }

        article code {
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: background-color 0.2s ease;
            display: inline-block;
            word-break: break-all;
        }

        article code:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        article code.copied {
            background-color: rgba(76, 175, 80, 0.3);
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            font-size: 14px;
            z-index: 1000;
            animation: slideUp 0.3s ease-in-out, slideDown 0.3s ease-in-out 2.7s forwards;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            to {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
        }
    </style>

    <meta name="description" content="Donate for DooM RPG Remake Project">
    <meta name="keywords"
        content="Donate, crypto, cryptocurrency, support, DRRP, DRPG, Doom RPG Remake Project, Doom RPG, J2ME, Java, doom mod, GZDoom, Jamdat, дум рпг">
    <meta name="robots" content="index, follow" />

    <!-- Open Graph -->
    <meta property="og:title" content="Donate for [DRRP] DooM RPG Remake Project">
    <meta property="og:image" content="https://media.moddb.com/images/mods/1/42/41020/doom-rpg-remake-project.png">
    <meta property="og:site_name" content="DRRPDonate">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://drrpofficial.tk/">
    <meta property="og:locale" content="en_US">
    <meta property="og:locale:alternate" content="ru_RU">
    <meta property="og:locale:alternate" content="en_GB">
    <meta property="og:description"
        content="Donate for DRRP! DRRP - The modern classic. The GZDoom remake of idSoftware's mobile Doom RPG game.">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVRM7HDF5F"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-FVRM7HDF5F');
    </script>
</head>

<body>
    <div class="background"></div>

    <div class="page">
        <h1>Support Doom RPG Remake Project!</h1>

        <h2 id="donation-counter">Current donations: Loading...</h2>

        <main>
            <article>
                <header>Tron (TRX or USDT <small>in TRC-20</small>):</header>
                <img
                    src="img/qr/tron.svg"/>
                <footer>
                    <code class="copyable">TDcgLCmXG2AL8KygYLXgPQhxiYPXDngVLd</code>
                </footer>
            </article>

            <article>
                <header>Ton (TON or USDT <small>in TON</small>):</header>
                <img
                    src="img/qr/ton.svg">
                <footer>
                    <code class="copyable">UQDMW3oN3xiy8tufenBL3Vzr-kY2bZGW6HsBkEk3z9w5UvZl</code>
                </footer>
            </article>
            <article>
                <header>Aptos (APT or USDC <small>in Aptos</small>):</header>
                <img src="img/qr/aptos.svg">
                <footer>
                    <code class="copyable">0xf074e517171ad7687cec4632f923aa32f3ddf07f5036830895f3e317ade46051</code>
                </footer>
            </article>
        </main>
    </div>

    <script>
        // Cryptocurrency addresses
        const ADDRESSES = {
            tron: 'TDcgLCmXG2AL8KygYLXgPQhxiYPXDngVLd',
            ton: 'UQDMW3oN3xiy8tufenBL3Vzr-kY2bZGW6HsBkEk3z9w5UvZl',
            aptos: '0xf074e517171ad7687cec4632f923aa32f3ddf07f5036830895f3e317ade46051'
        };

        // USDT contract address on Tron (TRC-20)
        const USDT_TRC20_CONTRACT = 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t';

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Fetch Tron balance (TRX and USDT-TRC20)
        async function getTronBalance() {
            try {
                const response = await fetch(`https://api.trongrid.io/v1/accounts/${ADDRESSES.tron}`);
                const data = await response.json();

                let usdtBalance = 0;

                if (data.data && data.data.length > 0) {
                    const account = data.data[0];

                    // Check for TRC20 tokens (USDT)
                    if (account.trc20) {
                        const usdtToken = account.trc20.find(token =>
                            token[USDT_TRC20_CONTRACT]
                        );
                        if (usdtToken && usdtToken[USDT_TRC20_CONTRACT]) {
                            usdtBalance = parseInt(usdtToken[USDT_TRC20_CONTRACT]) / 1e6; // USDT has 6 decimals
                        }
                    }
                }

                return { usdt: usdtBalance };
            } catch (error) {
                console.error('Error fetching Tron balance:', error);
                return { usdt: 0 };
            }
        }

        // Fetch TON balance
        async function getTonBalance() {
            try {
                // Convert address format if needed and fetch balance
                const response = await fetch(`https://toncenter.com/api/v2/getAddressBalance?address=${ADDRESSES.ton}`);
                const data = await response.json();

                let tonBalance = 0;
                if (data.ok && data.result) {
                    tonBalance = parseInt(data.result) / 1e9; // TON has 9 decimals
                }

                // Note: USDT on TON would require additional API calls to jetton contracts
                // For now, we'll focus on native TON balance

                return { ton: tonBalance };
            } catch (error) {
                console.error('Error fetching TON balance:', error);
                return { ton: 0 };
            }
        }

        // Fetch Aptos balance (APT and USDC)
        async function getAptosBalance() {
            try {
                // Fetch native APT balance
                const response = await fetch(`https://fullnode.mainnet.aptoslabs.com/v1/accounts/${ADDRESSES.aptos}/resource/0x1::coin::CoinStore<0x1::aptos_coin::AptosCoin>`);
                const data = await response.json();

                let aptBalance = 0;
                let usdcBalance = 0;

                if (data.data && data.data.coin && data.data.coin.value) {
                    aptBalance = parseInt(data.data.coin.value) / 1e8; // APT has 8 decimals
                }

                // Fetch USDC balance (USDC on Aptos)
                try {
                    const usdcResponse = await fetch(`https://fullnode.mainnet.aptoslabs.com/v1/accounts/${ADDRESSES.aptos}/resource/0x1::coin::CoinStore<0xf22bede237a07e121b56d91a491eb7bcdfd1f5907926a9e58338f964a01b17fa::asset::USDC>`);
                    const usdcData = await usdcResponse.json();

                    if (usdcData.data && usdcData.data.coin && usdcData.data.coin.value) {
                        usdcBalance = parseInt(usdcData.data.coin.value) / 1e6; // USDC has 6 decimals
                    }
                } catch (usdcError) {
                    console.log('No USDC balance or error fetching USDC:', usdcError);
                }

                return { apt: aptBalance, usdc: usdcBalance };
            } catch (error) {
                console.error('Error fetching Aptos balance:', error);
                return { apt: 0, usdc: 0 };
            }
        }

        // Update donation counter
        async function updateDonationCounter() {
            try {
                const [tronBalances, tonBalances, aptosBalances] = await Promise.all([
                    getTronBalance(),
                    getTonBalance(),
                    getAptosBalance()
                ]);

                // Sum up all USD stablecoins
                const totalUSD = tronBalances.usdt + aptosBalances.usdc;
                const totalTON = tonBalances.ton;
                const totalAPT = aptosBalances.apt;

                // Format the display string
                const parts = [];

                if (totalUSD > 0) {
                    parts.push(`${totalUSD.toFixed(2)}$`);
                }

                if (totalTON > 0) {
                    parts.push(`${totalTON.toFixed(2)} TON`);
                }

                if (totalAPT > 0) {
                    parts.push(`${totalAPT.toFixed(2)} APT`);
                }

                const displayText = parts.length > 0 ? parts.join(' + ') : '0$';

                document.getElementById('donation-counter').textContent = `Current donations: ${displayText}`;
            } catch (error) {
                console.error('Error updating donation counter:', error);
                document.getElementById('donation-counter').textContent = 'Current donations: 0$';
            }
        }

        // Copy to clipboard functionality
        document.querySelectorAll('.copyable').forEach(element => {
            element.addEventListener('click', function() {
                const address = this.textContent;
                navigator.clipboard.writeText(address).then(() => {
                    this.classList.add('copied');
                    showToast('Address copied to clipboard!');
                    setTimeout(() => {
                        this.classList.remove('copied');
                    }, 2000);
                }).catch(() => {
                    showToast('Failed to copy address');
                });
            });
        });

        // Fetch balances on page load
        window.addEventListener('DOMContentLoaded', updateDonationCounter);
    </script>
</body>

</html>
